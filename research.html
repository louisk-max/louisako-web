<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L.K. Capital | Research Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,500;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%230a2540%22/><text y=%2265%22 font-size=%2250%22 font-family=%22serif%22 font-weight=%22bold%22 x=%2250%22 text-anchor=%22middle%22 fill=%22%23c5a059%22>LK</text></svg>">
    <style>
        /* === å…¨å±€æ ·å¼ === */
        :root { --bg: #ffffff; --text-main: #1a1a1a; --text-light: #555; --accent: #0a2540; --gold: #c5a059; --sidebar-bg: #f8f9fa; --border: #e5e5e5; --code-bg: #f4f6f8; --font-heading: "Playfair Display", serif; }
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        body { margin: 0; padding: 0; font-family: "Inter", sans-serif; color: var(--text-main); background: var(--bg); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* è¯­è¨€åˆ‡æ¢ç±» */
        .lang-cn { display: none !important; } .lang-en { display: block !important; }
        body.cn-mode .lang-cn { display: block !important; } body.cn-mode .lang-en { display: none !important; }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .top-bar { height: 70px; flex-shrink: 0; background: #fff; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 0 30px; z-index: 100; }
        .brand { font-family: var(--font-heading); font-weight: 700; color: var(--accent); text-decoration: none; font-size: 1.2rem; }
        .nav-right { display: flex; gap: 30px; align-items: center; }
        .nav-link { color: var(--text-light); text-decoration: none; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; cursor: pointer; transition: 0.3s; }
        .nav-link:hover { color: var(--accent); }
        
        /* æ ¸å¿ƒå¸ƒå±€ */
        .library-layout { display: flex; flex: 1; overflow: hidden; height: calc(100vh - 70px); }
        
        /* ä¾§è¾¹æ  (æ¡Œé¢ç«¯) */
        .sidebar { width: 320px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; overflow-y: auto; }
        .sidebar-header { padding: 30px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .sidebar-title { font-family: var(--font-heading); font-size: 1.4rem; color: var(--accent); margin: 0; }
        .sidebar-subtitle { font-size: 0.75rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; display: block; }
        .sidebar-content { padding: 30px; }
        .cat-group { margin-bottom: 40px; }
        .cat-name { font-size: 0.75rem; font-weight: 800; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; display: block; }
        .article-link { display: block; padding: 10px 0; color: #444; font-size: 0.95rem; line-height: 1.4; cursor: pointer; transition: 0.2s; border-left: 2px solid transparent; padding-left: 0; }
        .article-link:hover { color: var(--accent); padding-left: 10px; border-left-color: var(--gold); }
        
        /* ä¸»å†…å®¹åŒº */
        .main-view { flex: 1; overflow-y: auto; scroll-behavior: smooth; background: #fff; position: relative; }
        
        /* æ¬¢è¿å± */
        .welcome-screen { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; background-image: radial-gradient(#e5e5e5 1px, transparent 1px); background-size: 30px 30px; padding: 20px; }
        .slogan-main { font-family: "Playfair Display"; font-size: 3.5rem; color: var(--accent); margin-bottom: 20px; opacity: 0; animation: fadeUp 1s forwards; }
        
        /* æ–‡ç« å®¹å™¨ */
        .article-container { max-width: 800px; margin: 0 auto; padding: 80px 40px 150px; display: none; position: relative; z-index: 2; }
        .article-container.active { display: block; animation: fadeIn 0.5s ease; }
        
        /* æ–‡ç« æ’ç‰ˆæ ·å¼ */
        .report-header { margin-bottom: 60px; border-bottom: 1px solid var(--border); padding-bottom: 40px; }
        .report-label { font-size: 0.8rem; font-weight: 700; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; display: block; }
        .report-title { font-family: "Playfair Display"; font-size: 2.8rem; color: var(--accent); margin-bottom: 20px; line-height: 1.1; }
        .report-meta { font-family: "JetBrains Mono", monospace; font-size: 0.8rem; color: #888; background: var(--code-bg); padding: 10px 15px; display: inline-block; border-radius: 4px; }
        
        h2 { font-family: "Playfair Display"; font-size: 1.8rem; color: var(--accent); margin-top: 80px; margin-bottom: 30px; border-bottom: 1px solid var(--gold); padding-bottom: 10px; }
        h3 { font-size: 1.2rem; font-weight: 700; margin-top: 50px; margin-bottom: 20px; color: #333; }
        p { line-height: 1.8; color: #444; margin-bottom: 20px; font-size: 1.05rem; text-align: justify; }
        ul, ol { margin-bottom: 25px; color: #444; padding-left: 20px; line-height: 1.8; }
        li { margin-bottom: 10px; }
        
        .concept-box { background: var(--code-bg); border-left: 4px solid var(--accent); padding: 25px; margin: 30px 0; border-radius: 0 8px 8px 0; }
        .concept-title { font-family: "Inter"; font-weight: 800; color: var(--accent); display: block; margin-bottom: 10px; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        
        /* è®¡ç®—å™¨æ ·å¼ */
        .calc-wrapper { background: var(--code-bg); border: 1px solid var(--border); border-radius: 8px; padding: 30px; margin: 40px 0; }
        .calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .calc-input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-family: "JetBrains Mono"; font-size: 1rem; }
        .calc-result-box { margin-top: 20px; padding: 20px; background: #fff; border-left: 4px solid var(--gold); }
        .calc-res-value { font-size: 1.5rem; font-weight: 700; color: var(--accent); font-family: "JetBrains Mono"; }
        
        /* ç›®å½•/è¿”å›æŒ‰é’® */
        .toc-back-btn { display: inline-block; margin-bottom: 20px; font-size: 0.8rem; color: var(--text-light); cursor: pointer; padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px; transition: 0.3s; }
        .toc-back-btn:hover { background: #f5f5f5; color: var(--accent); }
        .toc-list { list-style: none; padding: 0; margin: 0; border-left: 2px solid #eee; }
        .toc-link { display: block; padding: 6px 0 6px 15px; font-size: 0.85rem; color: #666; text-decoration: none; border-left: 2px solid transparent; margin-left: -2px; cursor: pointer; }
        .toc-link:hover { color: var(--accent); font-weight: 700; border-left-color: var(--gold); }
        .toc-h3 { padding-left: 30px; font-size: 0.8rem; }
        
        /* è¡¨æ ¼ä¸å…¬å¼ */
        table { width: 100%; border-collapse: collapse; margin: 40px 0; font-size: 0.95rem; }
        th, td { padding: 15px; border: 1px solid var(--border); text-align: left; }
        th { background: var(--accent); color: #fff; font-weight: 600; font-family: "Inter"; }
        .math-block { text-align: center; font-family: "Times New Roman", serif; font-style: italic; font-size: 1.3rem; padding: 20px; background: #fff; border: 1px dashed #ddd; margin: 30px 0; }
        
        /* èƒŒæ™¯æ°´å° */
        .brand-watermark { position: fixed; top: 50%; left: 58%; transform: translate(-50%, -50%) rotate(-30deg); font-family: "Playfair Display", serif; font-weight: 900; font-size: 7rem; color: #000; opacity: 0.03; pointer-events: none; z-index: 0; }
        
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* === ğŸ“± æ‰‹æœºç«¯æ·±åº¦ä¼˜åŒ– (è¿™æ˜¯ä¿®å¤çš„æ ¸å¿ƒéƒ¨åˆ†) === */
        @media (max-width: 900px) {
            /* å¸ƒå±€åˆ‡æ¢ä¸ºå‚ç›´ */
            .library-layout { flex-direction: column; height: auto; overflow: visible; }
            body { overflow: auto; } /* å…è®¸æ‰‹æœºé¡µé¢æ•´ä½“æ»šåŠ¨ */
            
            /* ä¾§è¾¹æ ä¼˜åŒ– - å˜æˆé¡¶éƒ¨å¯æŠ˜å æˆ–ç›´æ¥æ˜¾ç¤º */
            .sidebar { width: 100%; height: auto; max-height: none; border-right: none; border-bottom: 1px solid var(--border); }
            .sidebar-content { padding: 20px; }
            .sidebar-title { font-size: 1.2rem; }
            
            /* ä¸»å†…å®¹åŒºä¼˜åŒ– */
            .main-view { overflow: visible; }
            .article-container { padding: 40px 20px 100px !important; } /* å¢åŠ è¾¹è·ï¼Œé˜²æ­¢è´´è¾¹ */
            
            /* å­—ä½“ä¸æ’ç‰ˆä¿®å¤ */
            .report-title { font-size: 2rem !important; line-height: 1.2 !important; word-wrap: break-word; }
            .slogan-main { font-size: 2.5rem; }
            h1 { font-size: 2rem !important; }
            h2 { font-size: 1.5rem !important; margin-top: 40px !important; }
            h3 { font-size: 1.2rem !important; }
            p, li { font-size: 1rem !important; text-align: justify; }
            
            /* æ°´å°æ·¡åŒ– */
            .brand-watermark { font-size: 4rem !important; opacity: 0.02 !important; left: 50%; }
            
            /* "è¿”å›"æŒ‰é’®ç¾åŒ– */
            .toc-back-btn { 
                display: block; width: 100%; text-align: center; 
                padding: 12px; background: #f4f6f8; border: 1px solid #eee; 
                margin-bottom: 20px !important; 
            }
            
            /* ç›®å½•åˆ—è¡¨ä¼˜åŒ– */
            .toc-list { background: #fafafa; padding: 15px !important; border-radius: 8px; border: none !important; margin-bottom: 30px !important; }
            .toc-link { padding: 12px 0 !important; border-bottom: 1px dashed #eee; }
            
            /* è®¡ç®—å™¨ä¿®å¤ */
            .calc-grid { grid-template-columns: 1fr !important; gap: 15px !important; }
            .calc-wrapper { padding: 20px !important; }
            
            /* å¯¼èˆªæ å¾®è°ƒ */
            .top-bar { padding: 0 15px; }
            .nav-link { display: none; } /* æ‰‹æœºä¸Šéšè—å¤šä½™é“¾æ¥ï¼Œåªç•™Home */
        }
    </style>
</head>
<body class="en-mode"> 
    <div class="top-bar">
        <a href="index.html" class="brand">L.K. Research</a>
        <div class="nav-right">
            <a href="index.html" class="nav-link">Home</a>
        </div>
    </div>
    
    <div class="library-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Library</h2>
                <span class="sidebar-subtitle">L.K. Capital Proprietary</span>
            </div>
            <div class="sidebar-content" id="sidebar-list">
                <div style="color:#999; text-align:center;">Loading...</div>
            </div>
        </aside>
        
        <main class="main-view" id="main-scroll">
            <div id="view-welcome" class="welcome-screen">
                <div class="slogan-main">Discipline Creates Freedom.</div>
                <p style="color:#888; max-width:400px; margin:0 auto;">Select a research paper from the library to begin.</p>
            </div>
            
            <div id="view-article" class="article-container">
                <div class="brand-watermark">Louis K</div>
                <div id="article-inject-point"></div>
                <div style="margin-top: 60px; padding-top: 30px; text-align: center; color: #999; font-size: 0.8rem; border-top: 1px solid #eee;">
                    &copy; 2025 Louis K. Institutional Use Only.
                </div>
            </div>
        </main>
    </div>

    <script>
        let currentLang = 'en'; 
        let articleDatabase = [];
        let currentArticleId = null;

        function toggleLanguage() { setLanguage(currentLang === 'en' ? 'cn' : 'en'); }
        function setLanguage(lang) {
            currentLang = lang;
            if (lang === 'cn') { document.body.classList.remove('en-mode'); document.body.classList.add('cn-mode'); } 
            else { document.body.classList.remove('cn-mode'); document.body.classList.add('en-mode'); }
            if(articleDatabase.length > 0) renderCatalog();
        }

        async function init() {
            const userLang = navigator.language || navigator.userLanguage; 
            if (userLang.toLowerCase().includes('zh')) { setLanguage('cn'); } else { setLanguage('en'); }

            try {
                const resp = await fetch('research_data/database.json');
                if(!resp.ok) throw new Error("DB Load Failed");
                articleDatabase = await resp.json();
                renderCatalog();
                
                const hash = window.location.hash.substring(1);
                if(hash) loadArticle(hash);

            } catch (e) {
                document.getElementById('sidebar-list').innerHTML = '<div style="color:red; padding:20px;">Error loading library. Check console.</div>';
                console.error(e);
            }
        }

        function renderCatalog() {
            let html = '';
            articleDatabase.forEach(group => {
                const catName = currentLang === 'cn' ? group.category_cn : group.category_en;
                html += `<div class="cat-group"><span class="cat-name">${catName}</span>`;
                group.items.forEach(art => {
                    const title = currentLang === 'cn' ? art.title_cn : art.title_en;
                    html += `<div class="article-link" onclick="loadArticle('${art.id}')">${title}</div>`;
                });
                html += `</div>`;
            });
            document.getElementById('sidebar-list').innerHTML = html;
        }

        async function loadArticle(id) {
            let targetItem = null;
            for(const g of articleDatabase) {
                const found = g.items.find(i => i.id === id);
                if(found) { targetItem = found; break; }
            }
            if(!targetItem) return;

            currentArticleId = id;
            window.location.hash = id;
            
            document.getElementById('view-welcome').style.display = 'none';
            const container = document.getElementById('view-article');
            container.classList.add('active');
            document.getElementById('article-inject-point').innerHTML = '<div style="text-align:center; padding:50px; color:#999;">Loading Content...</div>';

            try {
                const fileResp = await fetch(targetItem.file);
                if(!fileResp.ok) throw new Error("File missing");
                const html = await fileResp.text();
                
                document.getElementById('article-inject-point').innerHTML = html;
                
                // æ‰‹æœºç«¯è‡ªåŠ¨æ»šåˆ°é¡¶éƒ¨
                if(window.innerWidth <= 900) {
                    window.scrollTo({top: 0, behavior: 'smooth'});
                } else {
                    document.getElementById('main-scroll').scrollTop = 0;
                }
                
                regenerateTOC();

            } catch (e) {
                document.getElementById('article-inject-point').innerHTML = `<div style="color:red;">Could not load file: ${targetItem.file}</div>`;
            }
        }

        function regenerateTOC() {
            const backText = currentLang === 'en' ? "â† Back to Library" : "â† è¿”å›çŸ¥è¯†åº“";
            let tocHTML = `<div class="toc-back-btn" onclick="goBack()">${backText}</div>`;
            
            // åªæœ‰åœ¨æ‰‹æœºç«¯æ˜¾ç¤º "è¿”å›" æŒ‰é’®
            if(window.innerWidth > 900) tocHTML = ''; 
            // ä½†ä¸ºäº†ç»Ÿä¸€ï¼Œæˆ‘ä»¬åœ¨ä¾§è¾¹æ é¡¶éƒ¨å§‹ç»ˆä¿ç•™ "è¿”å›" åŠŸèƒ½æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™é‡Œä¸»è¦æ˜¯åœ¨æ‰‹æœºç«¯ç”Ÿæˆå†…å®¹é‡Œçš„è¿”å›é”®
            
            // ä¿®æ­£ï¼šåœ¨æ–‡ç« é¡¶éƒ¨æ’å…¥ä¸€ä¸ªè¿”å›æŒ‰é’®ï¼ˆä»…æ‰‹æœºç«¯æ˜¾ç¤ºï¼‰
            const injectPoint = document.getElementById('article-inject-point');
            if(window.innerWidth <= 900) {
                const mobileBackBtn = document.createElement('div');
                mobileBackBtn.className = 'toc-back-btn';
                mobileBackBtn.innerText = backText;
                mobileBackBtn.onclick = goBack;
                injectPoint.insertBefore(mobileBackBtn, injectPoint.firstChild);
            }
        }

        function goBack() {
            document.getElementById('view-welcome').style.display = 'flex';
            document.getElementById('view-article').classList.remove('active');
            window.location.hash = '';
            // æ‰‹æœºç«¯æ»šå›é¡¶éƒ¨
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        window.calculateRR = function() {
            const w = parseFloat(document.getElementById('input-wr').value);
            if(w) document.getElementById('res-rr').innerText = "1 : " + ((1-(w/100))/(w/100)).toFixed(2);
        }
        window.calculateWR = function() {
            const r = parseFloat(document.getElementById('input-rr').value);
            if(r) document.getElementById('res-wr').innerText = (1/(1+r)*100).toFixed(1) + "%";
        }

        init();
    </script>
</body>
</html>
