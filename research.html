<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L.K. Capital | Research Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,500;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%230a2540%22/><text y=%2265%22 font-size=%2250%22 font-family=%22serif%22 font-weight=%22bold%22 x=%2250%22 text-anchor=%22middle%22 fill=%22%23c5a059%22>LK</text></svg>">
    
    <style>
        /* === 样式系统 === */
        :root { --bg: #ffffff; --text-main: #1a1a1a; --accent: #0a2540; --gold: #c5a059; --sidebar-bg: #f8f9fa; --border: #e5e5e5; }
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: "Inter", sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        .top-bar { height: 70px; flex-shrink: 0; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
        .brand { font-family: "Playfair Display"; font-weight: 700; color: var(--accent); text-decoration: none; font-size: 1.2rem; }
        .nav-link { color: #555; text-decoration: none; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; margin-left: 30px; }
        
        .layout { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 320px; background: var(--sidebar-bg); border-right: 1px solid var(--border); overflow-y: auto; display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px; border-bottom: 1px solid #eee; }
        .sidebar-title { font-family: "Playfair Display"; font-size: 1.4rem; color: var(--accent); margin: 0; }
        
        .cat-group { margin-bottom: 30px; padding: 0 30px; }
        .cat-name { font-size: 0.75rem; font-weight: 800; color: var(--gold); text-transform: uppercase; margin-bottom: 15px; display: block; margin-top: 30px; }
        .article-link { display: block; padding: 8px 0; color: #444; font-size: 0.95rem; cursor: pointer; transition:0.2s; line-height:1.4; }
        .article-link:hover { color: var(--accent); font-weight: 600; transform: translateX(5px); }

        .main-view { flex: 1; overflow-y: auto; scroll-behavior: smooth; position: relative; }
        .container { max-width: 800px; margin: 0 auto; padding: 80px 40px 150px; }
        
        /* 动态内容样式 */
        .report-header { margin-bottom: 50px; padding-bottom: 30px; border-bottom: 1px solid #eee; }
        .report-title { font-family: "Playfair Display"; font-size: 2.5rem; color: var(--accent); line-height: 1.2; margin-top: 10px; }
        .report-label { color: var(--gold); font-weight: 700; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 2px; }
        h2 { font-family: "Playfair Display"; font-size: 1.8rem; color: var(--accent); margin-top: 60px; border-bottom: 1px solid var(--gold); padding-bottom: 10px; }
        h3 { font-size: 1.3rem; font-weight: 700; margin-top: 40px; color: #333; }
        p { line-height: 1.8; color: #444; margin-bottom: 20px; text-align: justify; }
        li { margin-bottom: 10px; line-height: 1.6; }
        .concept-box { background: #f4f6f8; border-left: 4px solid var(--accent); padding: 25px; margin: 30px 0; }
        .concept-title { font-weight: 800; color: var(--accent); display: block; margin-bottom: 10px; text-transform: uppercase; }
        
        /* 计算器样式 */
        .calc-wrapper { background: #f4f6f8; border: 1px solid #ddd; border-radius: 8px; padding: 30px; margin: 40px 0; }
        .calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .calc-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        
        @media(max-width: 900px) { .layout { flex-direction: column; } .sidebar { width: 100%; height: 300px; } }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="index.html" class="brand">L.K. Research</a>
        <div class="nav-right"><a href="index.html" class="nav-link">Home</a></div>
    </div>

    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Library</h2>
                <span style="font-size:0.75rem; color:#888;">PROPRIETARY ANALYSIS</span>
            </div>
            <div id="catalog-list"></div> </aside>

        <main class="main-view" id="main-scroll">
            <div id="content-area" class="container">
                <div style="text-align:center; margin-top:100px; color:#999;">
                    <h2>Select a report from the library</h2>
                </div>
            </div>
        </main>
    </div>

    <script>
        // === 核心逻辑：读取文件 ===
        async function init() {
            try {
                // 1. 读取 database.json
                const response = await fetch('research_data/database.json');
                if (!response.ok) throw new Error("Cannot load database");
                const data = await response.json();
                
                // 2. 生成目录
                renderSidebar(data);

                // 3. 如果URL有锚点，自动加载文章
                const hash = window.location.hash.substring(1);
                if(hash) loadPage(hash, data);

            } catch (e) {
                document.getElementById('catalog-list').innerHTML = `<p style="padding:20px; color:red">Error: Need Local Server or Upload to Web Host.<br>${e.message}</p>`;
            }
        }

        function renderSidebar(data) {
            const sidebar = document.getElementById('catalog-list');
            let html = '';
            data.forEach(group => {
                html += `<div class="cat-group"><span class="cat-name">${group.category}</span>`;
                group.articles.forEach(art => {
                    // 将文章路径存入 onclick
                    html += `<div class="article-link" onclick="loadPage('${art.id}', null, '${art.file}')">${art.title}</div>`;
                });
                html += `</div>`;
            });
            sidebar.innerHTML = html;
        }

        // 加载具体的 .html 文件
        async function loadPage(id, dataObj, filePath) {
            // 如果是从URL加载，需要先在数据里找路径
            if(!filePath && dataObj) {
                dataObj.forEach(g => {
                    const found = g.articles.find(a => a.id === id);
                    if(found) filePath = found.file;
                });
            }
            if(!filePath) return;

            const contentDiv = document.getElementById('content-area');
            contentDiv.innerHTML = '<p style="text-align:center; color:#999; margin-top:50px;">Loading...</p>';
            
            try {
                // 读取独立的 HTML 文件
                const resp = await fetch(filePath);
                if(!resp.ok) throw new Error("File not found");
                const html = await resp.text();
                
                contentDiv.innerHTML = html;
                document.getElementById('main-scroll').scrollTop = 0;
                window.location.hash = id; // 更新URL

            } catch (e) {
                contentDiv.innerHTML = `<h3 style="color:red">Failed to load report.</h3><p>Ensure '${filePath}' exists in the folder.</p>`;
            }
        }

        // 全局计算器函数
        window.calcRR = () => {
            const w = document.getElementById('in-wr').value;
            if(w) document.getElementById('out-rr').innerText = "1 : " + ((1-(w/100))/(w/100)).toFixed(2);
        };
        window.calcWR = () => {
            const r = document.getElementById('in-rr').value;
            if(r) document.getElementById('out-wr').innerText = (1/(1+parseFloat(r))*100).toFixed(1) + "%";
        };

        init();
    </script>
</body>
</html>